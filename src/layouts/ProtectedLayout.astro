---
import Layout from "./Layout.astro";

interface Props {
    title: string;
}

const { title } = Astro.props;
---

<Layout title={title}>
    <div id="auth-loading" class="loading-screen">
        <div class="spinner"></div>
    </div>

    <div id="protected-content" style="display: none;">
        <slot />
    </div>
</Layout>

<script>
    import { auth } from "../firebase/client";
    import { onAuthStateChanged } from "firebase/auth";

    const loadingScreen = document.getElementById("auth-loading");
    const protectedContent = document.getElementById("protected-content");

    onAuthStateChanged(auth, (user) => {
        if (user) {
            if (loadingScreen) loadingScreen.style.display = "none";
            if (protectedContent) {
                protectedContent.style.display = "block";
                protectedContent.classList.add("auth-fade-in");
            }
        } else {
            window.location.href = "/login";
        }
    });
</script>

<style>
    .loading-screen {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #f7fafc;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #e2e8f0;
        border-top-color: #d69e2e;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .auth-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
</style>
